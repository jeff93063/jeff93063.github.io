<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Filter</title>
    <style>
      .imageContainer {
        overflow: auto;
      }

      #image {
        max-width: 50%;
      }

      #imageHidden {
        display: none;
      }

      #canvasHidden {
        display: none;
      }

      #container {
        display: none;
        width: 100%;
        height: 450px;
    }
    </style>
    <script type="module">
      import { BlackwhiteFilter, InvertFilter, GrayscaleFilter, SepiaFilter, GaussianBlurFilter } from './image-filter.js';
      window["GrayscaleFilter"] = GrayscaleFilter;
      window["SepiaFilter"] = SepiaFilter;
      window["InvertFilter"] = InvertFilter;
      window["BlackwhiteFilter"] = BlackwhiteFilter;
      window["GaussianBlurFilter"] = GaussianBlurFilter;
    </script>
	<script src="pdfobject.min.js"></script>
	<script src="jspdf.umd.min.js"></script>
	<script>
var imgData = 'data:image/png;base64,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';
const { jsPDF } = window.jspdf;
function embedpdf(){
	PDFObject.embed(testpdf(), "#pdfDiv");
}

function testpdf(){
	const src = document.getElementById("image").src;
	// const blob = URL.createObjectURL(src);
	console.log(src);
	var doc = new jsPDF({
		orientation: "portrait",
		unit: "in",
		format: [8.5,11]
	});
	doc.addImage(src, 'PNG', .25, .25, 8, 10.5);
	return doc.output("datauristring");
}

	</script>
  </head>
  <body>
    <div class="home">
      <h2>Image Filter</h2>
      <button id="loadFileButton">Load a File</button>
      <input style="display:none;" type="file" id="file" onchange="loadImageFromFile();" accept=".jpg,.jpeg,.png,.bmp">
      <label>
        Effect:
        <select id="effectSelect">
          <option>Sepia</option>
          <option>Grayscale</option>
          <option>Invert</option>
          <option>Black &amp; White (50% Threshold)</option>
          <option>Black &amp; White (OTSU)</option>
          <option selected="selected">Black &amp; White (Adaptive)</option>
          <option>Gaussian Blur</option>
        </select>
      </label>
      <button id="convertButton">Convert</button>
      <button id="downloadButton">Download</button>
      <div class="imageContainer">
        <img id="image">
        <img id="imageHidden">
      </div>
      <canvas id="canvasHidden"></canvas>
    </div>
    <script>
      let cvs = document.getElementById("canvasHidden");
      let grayscaleFilter;
      let sepiaFilter;
      let blackwhiteFilter;
      let invertFilter;
      let gaussianBlurFilter;
      let editViewer;

      window.onload = function (){
        grayscaleFilter = new GrayscaleFilter(cvs);
        sepiaFilter = new SepiaFilter(cvs);
        blackwhiteFilter = new BlackwhiteFilter(cvs);
        invertFilter = new InvertFilter(cvs);
        gaussianBlurFilter = new GaussianBlurFilter(cvs,3);
      }

      document.getElementById("loadFileButton").addEventListener("click",function(){
        document.getElementById("file").click();
      })

      document.getElementById("convertButton").addEventListener("click",function(){
        const img = document.getElementById("imageHidden");
        let effectIndex = document.getElementById("effectSelect").selectedIndex;
        if (effectIndex === 0) {
          sepiaFilter.process(img);
        }else if (effectIndex === 1){
          grayscaleFilter.process(img);
        }else if (effectIndex === 2){
          invertFilter.process(img);
        }else if (effectIndex === 3){
          blackwhiteFilter.setThreshold(127);
          blackwhiteFilter.setOTSUEnabled(false);
          let threshold = blackwhiteFilter.process(img);
          console.log("Threshold: "+threshold);
        }else if (effectIndex === 4){
          blackwhiteFilter.setOTSUEnabled(true);
          let threshold = blackwhiteFilter.process(img);
          console.log("Threshold: "+threshold);
        }else if (effectIndex === 5){
          blackwhiteFilter.setAdaptive(true,31,10);
          blackwhiteFilter.process(img);
        }else if (effectIndex === 6){
          gaussianBlurFilter.process(img);
        }
        document.getElementById("image").src = cvs.toDataURL();
      })

      document.getElementById("downloadButton").addEventListener("click",async function(){
        const src = document.getElementById("image").src;
        if (!src) {
          return;
        }
        const link = document.createElement('a');
        const response = await fetch(src);
        const blob = await response.blob();
        link.href = URL.createObjectURL(blob);
        link.target = "_blank";
        link.download = 'grayscale.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      })

      
      function loadImageFromFile(){
        let fileInput = document.getElementById("file");
        let files = fileInput.files;
        if (files.length == 0) {
          return;
        }
        document.getElementById("image").style.filter = "";
        let file = files[0];
        fileReader = new FileReader();
        fileReader.onload = function(e){
          document.getElementById("image").src = e.target.result;
          document.getElementById("imageHidden").src = e.target.result;
        };
        fileReader.onerror = function () {
          console.warn('oops, something went wrong.');
        };
        fileReader.readAsDataURL(file);
      }
    </script>

<button onclick="embedpdf();">Generate PDF</button>
<hr>
<div id="pdfDiv"></div>

</body></html>