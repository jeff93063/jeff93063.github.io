<img src="target/Jawbone250.png" id="testimage" />
<script>
var G=Object.defineProperty,L=(t,e,a)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,x=(t,e,a)=>(L(t,"symbol"!=typeof e?e+"":e,a),a);class T{constructor(t){x(this,"cvs"),this.cvs=t}process(t){let e,a;t instanceof HTMLImageElement?(e=t.naturalWidth,a=t.naturalHeight):t instanceof HTMLCanvasElement?(e=t.width,a=t.height):(e=t.videoWidth,a=t.videoHeight);let r=this.cvs.getContext("2d");if(this.cvs.width=e,this.cvs.height=a,r){r.drawImage(t,0,0);let i=r.getImageData(0,0,this.cvs.width,this.cvs.height),s=i.data;for(var l=0;l<s.length;l+=4){let n=s[l],h=s[l+1],o=s[l+2],u=s[l+3],c=this.convert(n,h,o,u);s[l]=c.r,s[l+1]=c.g,s[l+2]=c.b,s[l+3]=c.a}r.putImageData(i,0,0)}}convert(t,e,a,r){return{r:t,g:e,b:a,a:r}}}function P(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var H={};!function(t){function e(t){return function t(e){if(Array.isArray(e)){for(var a=0,r=Array(e.length);a<e.length;a++)r[a]=e[a];return r}}(t)||function t(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(t)||function t(){throw TypeError("Invalid attempt to spread non-iterable instance")}()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(t,e,a){for(var r=0,i=e;i<a;i+=1)r+=t[i];return r},r=function(t,e,a,r){for(var i=0,s=e;s<a;s+=1)i+=t[s];return i/r},i=function(t,e,a,r,i){for(var s=0,l=a;l<r;l+=1)s+=t[l]*e[l];return s*i},s=function(t,e,a,r,i,s){for(var l=0,n=a;n<r;n+=1){var h=e[n]-i;l+=h*h*t[n]}return l*s},l=function(t){var l,n,h,o=(l=t,Array.from(new Set(l)).sort(function(t,e){return t-e})),u=(n=t,h=o,n.reduce(function(t,e){return t[h.indexOf(e)]+=1,t},e(Array(h.length)).fill(0))),c=t.length,d=e(Array(o.length)).map(function(t,e){var l,n,h,d,$=e,g=e,p=u.length,f=1/a(u,0,$),v=1/a(u,g,p),_=r(u,0,$,c),m=s(u,o,0,$,i(u,o,0,$,f),f),y=r(u,g,p,c),b=s(u,o,g,p,i(u,o,g,p,v),v),w=(l=_,n=m,h=y,d=b,l*n+h*d);return isNaN(w)?Number.POSITIVE_INFINITY:w});return o[d.indexOf(Math.min.apply(Math,e(d)))]};t.default=l}(H);let K=P(H);class A extends T{constructor(t,e,a,r,i,s){super(t),x(this,"threshold",127),x(this,"otsuEnabled",!1),x(this,"adaptive",!1),x(this,"blockSize",31),x(this,"C",10),this.threshold=e,this.otsuEnabled=a,this.adaptive=r,this.blockSize=i,this.C=s}process(t){let e,a;t instanceof HTMLImageElement?(e=t.naturalWidth,a=t.naturalHeight):t instanceof HTMLCanvasElement?(e=t.width,a=t.height):(e=t.videoWidth,a=t.videoHeight);let r=this.cvs.getContext("2d");this.cvs.width=e,this.cvs.height=a;let i=0;if(r){r.drawImage(t,0,0);let s=r.getImageData(0,0,this.cvs.width,this.cvs.height);this.adaptive?s=this.adaptiveThresholdWithIntegralImage(s):i=this.globalThresholding(s),r.putImageData(s,0,0)}return i}adaptiveThresholdWithIntegralImage(t){let e=t.width,a=t.height,r=this.blockSize,i=this.C,s=t.data,l=new ImageData(e,a),n=l.data,h=this.computeIntegralImage(s,e,a),o=Math.floor(r/2);for(let u=0;u<a;u++)for(let c=0;c<e;c++){let d=Math.max(c-o,0),$=Math.max(u-o,0),g=Math.min(c+o,e-1),p=Math.min(u+o,a-1),f=(g-d+1)*(p-$+1),v=this.getAreaSum(h,e,d,$,g,p)/f-i,_=(u*e+c)*4,m=s[_];n[_]=n[_+1]=n[_+2]=m>v?255:0,n[_+3]=255}return l}computeIntegralImage(t,e,a){let r=new Uint32Array(e*a);for(let i=0;i<a;i++){let s=0;for(let l=0;l<e;l++){let n=(i*e+l)*4;s+=t[n],r[i*e+l]=(i>0?r[(i-1)*e+l]:0)+s}}return r}getAreaSum(t,e,a,r,i,s){let l=a>0&&r>0?t[(r-1)*e+(a-1)]:0,n=r>0?t[(r-1)*e+i]:0,h=a>0?t[s*e+(a-1)]:0;return t[s*e+i]-n-h+l}globalThresholding(t){let e=t.data,a=[];for(var r=0;r<e.length;r+=4){let i=e[r],s=e[r+1],l=e[r+2],n=this.grayscale(i,s,l);a.push(n)}let h;h=this.otsuEnabled?K(a):this.threshold;let o=0;for(var r=0;r<e.length;r+=4){let u=a[o];o+=1;let c=255;u<h&&(c=0),e[r]=c,e[r+1]=c,e[r+2]=c}return h}grayscale(t,e,a){return 6966*t+23436*e+2366*a>>15}setAdaptive(t,e,a){this.adaptive=t,this.blockSize=e,this.C=a}setThreshold(t){this.adaptive=!1,this.threshold=t}setOTSUEnabled(t){this.adaptive=!1,this.otsuEnabled=t}}class N extends T{convert(t,e,a,r){let i=6966*t+23436*e+2366*a>>15;return{r:i,g:i,b:i,a:r}}}class V extends T{convert(t,e,a,r){return{r:.393*t+.769*e+.189*a,g:.349*t+.686*e+.168*a,b:.272*t+.534*e+.131*a,a:r}}}class z extends T{constructor(t,e){super(t),x(this,"radius",127),this.radius=e}process(t){let e,a;t instanceof HTMLImageElement?(e=t.naturalWidth,a=t.naturalHeight):t instanceof HTMLCanvasElement?(e=t.width,a=t.height):(e=t.videoWidth,a=t.videoHeight);let r=this.cvs.getContext("2d");if(this.cvs.width=e,this.cvs.height=a,r){r.drawImage(t,0,0);let i=r.getImageData(0,0,this.cvs.width,this.cvs.height);i=this.applyGaussianBlur(i,this.radius),r.putImageData(i,0,0)}}applyGaussianBlur(t,e){let a=t.data,r=t.width,i=t.height,s=this.createGaussianKernel(e);for(let l=0;l<i;l++)for(let n=0;n<r;n++)this.applyKernel(a,s,n,l,r,i,!0);for(let h=0;h<i;h++)for(let o=0;o<r;o++)this.applyKernel(a,s,o,h,r,i,!1);return t}createGaussianKernel(t){let e=t/3,a=[],r=0;for(let i=-t;i<=t;i++){let s=Math.exp(-(i*i)/(2*e*e))/(Math.sqrt(2*Math.PI)*e);a.push(s),r+=s}for(let l=0;l<a.length;l++)a[l]/=r;return a}applyKernel(t,e,a,r,i,s,l){let n=0,h=0,o=0,u=0,c=(e.length-1)/2;for(let d=-c;d<=c;d++){let $=l?a+d:a,g=l?r:r+d;if($>=0&&$<i&&g>=0&&g<s){let p=(g*i+$)*4,f=e[d+c];n+=t[p]*f,h+=t[p+1]*f,o+=t[p+2]*f,u+=t[p+3]*f}}let v=(r*i+a)*4;t[v]=n,t[v+1]=h,t[v+2]=o,t[v+3]=u}}let D,M=document.createElement("canvas");window.Dynamsoft&&(D=window.Dynamsoft.DDV);let U=async()=>new Promise((t,e)=>{M.toBlob(a=>{a?t(a):e()},"image/jpeg",100)}),R=async t=>new Promise((e,a)=>{let r=document.createElement("img");r.onload=function(){e(r)};let i=URL.createObjectURL(t);r.src=i});if(!D){class t{}D={ImageFilter:t}}class J extends D.ImageFilter{async applyFilter(t,e){if("original"===e)return new Promise((e,a)=>{e(t.data)});{let a=await R(t.data);"BW"===e?new A(M,127,!0,!1,31,10).process(a):"BW (adaptive)"===e?new A(M,127,!0,!0,31,10).process(a):"sepia"===e?new V(M).process(a):"grayscale"===e?new N(M).process(a):"invert"===e?new q(M).process(a):"blur"===e&&new z(M,3).process(a);let r=await U();return new Promise((t,e)=>{t(r)})}}get defaultFilterType(){return"original"}querySupported(){return[{type:"original",label:"Original"},{type:"grayscale",label:"Gray"},{type:"BW",label:"B&W"},{type:"BW (adaptive)",label:"B&W (adaptive)"},{type:"invert",label:"Invert"},{type:"sepia",label:"Retro"},{type:"blur",label:"Blur"}]}destroy(){super.destroy()}}class q extends T{convert(t,e,a,r){return{r:t=255-t,g:e=255-e,b:a=255-a,a:r}}};
//export{A as BlackwhiteFilter,z as GaussianBlurFilter,T as GenericImageFilter,N as GrayscaleFilter,J as ImageFilterHandler,q as InvertFilter,V as SepiaFilter};
let GrayscaleFilter = N;
let cvs = document.createElement("canvas");
let grayscaleFilter = new GrayscaleFilter(cvs);
grayscaleFilter.process(document.getElementById("testimage"));
document.getElementById("testimage").src = cvs.toDataURL();

</script>

<!--<script type="text/javascript">
	import { ImageFilterHandler, BlackwhiteFilter, InvertFilter, GrayscaleFilter, SepiaFilter } from './image-filter.js';
	let cvs = document.createElement("canvas");
	let grayscaleFilter = new GrayscaleFilter(cvs);
	grayscaleFilter.process(document.getElementById("testimage"));
	document.getElementById("testimage").src = cvs.toDataURL();
</script>-->